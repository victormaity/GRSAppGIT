<script src="@Url.Content("~/Content/assets/js/dropzone.js")"></script>

<div class="widget-box" id="main_panel_content">
    <div class="widget-header">
        <h5 class="widget-title" title="Manual Upload">Manual Upload</h5>
        <div class="widget-toolbar">
            <a data-action="fullscreen" class="orange2">
                <i class="ace-icon fa fa-expand"></i>
            </a>
            <a data-action="collapse">
                <i class="ace-icon fa fa-chevron-up"></i>
            </a>
        </div>
    </div>
    <div class="widget-body">
        <div class="widget-main">
            <div>
                <div id="my-awesome-dropzone">
                    <div class="dz-default dz-message" id="dropzone">
                        <span class="dz-message dz-clickable"><span class="bigger-150 bolder"><i class="ace-icon fa fa-caret-right red"></i>Drop files</span> to upload 				<span class="smaller-80 grey">(or click)</span>
                            <br>
                            <i class="upload-icon ace-icon fa fa-cloud-upload blue fa-3x dz-clickable"></i></span>
                    </div>
                </div>
            </div>
            <!-- /.row -->
        </div>
    </div>
</div>

<script type="text/javascript">
    window.jQuery || document.write("<script src='../assets/js/jquery.min.js'>" + "<" + "/script>");
</script>

<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='~/Content/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    jQuery(function ($) {

        Dropzone.autoDiscover = false;
        try {
            var myDropzone = new Dropzone("#dropzone", {
                paramName: "files", // The name that will be used to transfer the file
                maxFilesize: 300, // MB
                url: '@Url.Action("ManualUploadTestCycle")',
                addRemoveLinks: false,
                uploadMultiple: true,
                clickable: true,
                dictDefaultMessage:
                    '<span class="bigger-150 bolder"><i class="ace-icon fa fa-caret-right red"></i> Drop files</span> to upload \
				<span class="smaller-80 grey">(or click)</span> <br /> \
				<i class="upload-icon ace-icon fa fa-cloud-upload blue fa-3x"></i>',
                dictResponseError: 'Error while uploading file!',
                accept: function (file, done) {
                    if (file.name.toLowerCase().search('.zip') != -1) {
                        done();
                    } else {
                        ShowMessage("Error", file.name + ",can not be uploaded, wrong file format");
                    }
                },
                success: function (msg) {
                    ShowMessage(msg.type, msg.text);
                },
                //change the previewTemplate to use Bootstrap progress bars
                previewTemplate: "<div class=\"dz-preview dz-file-preview\">\n  <div class=\"dz-details\">\n    <div class=\"dz-filename\"><span data-dz-name></span></div>\n    <div class=\"dz-size\" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class=\"progress progress-small progress-striped active\"><div class=\"progress-bar progress-bar-success\" data-dz-uploadprogress></div></div>\n    <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>\n</div>"
            });
            myDropzone.options.dropzoneForm = {
                init: function () {
                    myDropzone.on("complete", function () {
                        location.reload();
                    });
                }
            };
            myDropzone.on("complete", function (msg) {
                if (msg.status == "success") {
                    location.reload();
                }
            });
        } catch (e) {
            alert('Dropzone.js does not support older browsers!');
        }

    });
</script>
