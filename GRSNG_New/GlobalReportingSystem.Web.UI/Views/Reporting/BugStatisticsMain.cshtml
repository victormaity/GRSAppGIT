@model List<GlobalReportingSystem.Core.Models.GRS.CyclesModel>
@{
    ViewBag.Title = "BugStatistics";
}

<div class="page-header">
    <h1>Bug List
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            See all bugs here
        </small>
    </h1>
</div>

<div class="row">
    <div class="btn-group">
        <button class="btn btn-info btn-white btn-lg" onclick="RenderReport()">
            Select Test Cycle
            <i id="loading" class="fa fa-spinner blue"></i>
        </button>

        <button data-toggle="dropdown" class="btn btn-info btn-white btn-lg dropdown-toggle">
            <span class="ace-icon fa fa-caret-down icon-only"></span>
        </button>

        <ul class="dropdown-menu dropdown-info dropdown-menu-right" id="cycles">
            @{
                var counter = 1;
                var classname = "";
                foreach (var cycle in @Model)
                {
                    if (counter == 1)
                    {
                        classname = "selected";
                    }
                <li>
                    <a id="@cycle.Id" class="@classname" onclick="SetSelected(@cycle.Id);">@cycle.Name</a>
                </li>
                    counter = 0;
                    classname = "";
                }
            }
        </ul>
    </div>
    <br />
    <br />
    <div class="row">
        <div class="col-xs-12">
            <div id="bugStat"></div>
        </div>
    </div>
</div>

<script type="text/javascript">

    function SetSelected(currId) {
        var array = $("#cycles > li > a");
        for (var i = 0; i < array.length; i++) {
            $('#' + array[i].id).removeClass("selected");
        }
        $("#" + currId).addClass("selected");
    }

    function RenderReport() {
        var id = $("#cycles > li > a[class='selected']").attr('id');

        $.ajax({
            type: "POST",
            url: "@Url.Action("BugStatisticsTable", "Reporting")",
            async: true,
            data: "{'cycleId':" + id + "}",
            contentType: "application/json; charset=utf-8",
            dataType: "html",
            beforeSend: function () {
                $("#loading").addClass("fa-spin");
            },
            error: function () { },
            success: function (msg) {
                $("#loading").removeClass("fa-spin");
                if (IsJsonString(msg) && jQuery.parseJSON(msg).type == "Error") {
                    ShowMessage(jQuery.parseJSON(msg).type, jQuery.parseJSON(msg).text);
                } else {
                    $("#bugStat").html(msg.trim());
                }
            }
        });
    }
</script>