@model List<GlobalReportingSystem.Core.Models.GRS.CyclesModel>
@{
    ViewBag.Title = "CumulativeMain";
}

<div class="page-header">
    <h1>Cumulative Report
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            See statistics here
        </small>
    </h1>
</div>

<div class="row">
    <div class="btn-group">
        <button class="btn btn-info btn-white btn-lg" onclick="RenderReport()">
            Select Test Cycle
        </button>

        <button data-toggle="dropdown" class="btn btn-info btn-white btn-lg dropdown-toggle">
            <span class="ace-icon fa fa-caret-down icon-only"></span>
        </button>
        &nbsp;
        <i id="loading"></i>
        <ul class="dropdown-menu dropdown-info dropdown-menu-right" id="cycles" style="margin: 0px 4px 0px 0px!important;">
            @{
                var counter = 1;
                var classname = "";
                foreach (var cycle in @Model)
                {
                    if (!cycle.IsDeactivated)
                    {
                        if (counter == 1)
                        {
                            classname = "selected";
                        }
                <li>
                    <a id="@cycle.Id" class="@classname" onclick="SetSelected(@cycle.Id);">@cycle.Name</a>
                </li>
                        counter = 0;
                        classname = "";
                    }
                }
            }
        </ul>
    </div>
    <br />
    <br />
    <div class="row">
        <div class="col-xs-12">
            <div id="commulativeReport"></div>
        </div>
    </div>
</div>
<script src="@Url.Content("~/Content/assets/js/sticky-table-headers.js")"></script>

<script type="text/javascript">

    function SetSelected(currId) {
        var array = $("#cycles > li > a");
        for (var i = 0; i < array.length; i++) {
            $('#' + array[i].id).removeClass("selected");
        }
        $("#" + currId).addClass("selected");
        var cycleName = $("#" + currId).text();
        $(".btn-group > button").first().text(cycleName);
    }

    function RenderReport() {
        var id = $("#cycles > li > a[class='selected']").attr('id');

        $.ajax({
            type: "POST",
            url: "@Url.Action("CumulativeTable", "Reporting")",
            async: true,
            data: "{'cycleId':" + id + "}",
            contentType: "application/json; charset=utf-8",
            dataType: "html",
            beforeSend: function () {
                $("#loading").addClass("fa fa-spinner blue fa-spin");
            },
            error: function () {
                $("#loading").removeClass("fa fa-spinner blue fa-spin");
            },
            success: function (msg) {
                $("#loading").removeClass("fa fa-spinner blue fa-spin");
                if (IsJsonString(msg) && jQuery.parseJSON(msg).type == "Error") {
                    ShowMessage(jQuery.parseJSON(msg).type, jQuery.parseJSON(msg).text);
                } else {
                    $("#commulativeReport").html(msg.trim());
                }
            }
        });
    }
</script>
